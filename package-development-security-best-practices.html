<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Package Development Security Best Practices | rOpenSci Packages: Development, Maintenance, and Peer Review</title>
<meta name="author" content="rOpenSci software review editorial team (current and alumni): Brooke Anderson, Scott Chamberlain, Laura DeCicco, Julia Gustavsen, Anna Krystalli, Mauro Lepore, Lincoln Mullen, Karthik Ram, Noam Ross, Maëlle Salmon, Melina Vidoni">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9002/tabs.js"></script><script src="libs/bs3compat-0.2.4.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">rOpenSci Packages: Development, Maintenance, and Peer Review</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Building Your Package</li>
<li><a class="" href="building.html"><span class="header-section-number">1</span> Packaging Guide</a></li>
<li><a class="" href="ci.html"><span class="header-section-number">2</span> Continuous Integration Best Practices</a></li>
<li><a class="active" href="package-development-security-best-practices.html"><span class="header-section-number">3</span> Package Development Security Best Practices</a></li>
<li class="book-part">Software Peer Review of Packages</li>
<li><a class="" href="softwarereviewintro.html"><span class="header-section-number">4</span> Software Peer Review, Why? What?</a></li>
<li><a class="" href="policies.html"><span class="header-section-number">5</span> Software Peer Review policies</a></li>
<li><a class="" href="guide-for-authors.html"><span class="header-section-number">6</span> Guide for Authors</a></li>
<li><a class="" href="reviewerguide.html"><span class="header-section-number">7</span> Guide for Reviewers</a></li>
<li><a class="" href="editorguide.html"><span class="header-section-number">8</span> Guide for Editors</a></li>
<li class="book-part">Maintaining Packages</li>
<li><a class="" href="collaboration.html"><span class="header-section-number">9</span> Collaboration Guide</a></li>
<li><a class="" href="changing-maintainers.html"><span class="header-section-number">10</span> Changing package maintainers</a></li>
<li><a class="" href="releasing.html"><span class="header-section-number">11</span> Releasing a package</a></li>
<li><a class="" href="marketing.html"><span class="header-section-number">12</span> Marketing your package</a></li>
<li><a class="" href="grooming.html"><span class="header-section-number">13</span> GitHub Grooming</a></li>
<li><a class="" href="evolution.html"><span class="header-section-number">14</span> Package evolution - changing stuff in your package</a></li>
<li><a class="" href="curationpolicy.html"><span class="header-section-number">15</span> Package Curation Policy</a></li>
<li><a class="" href="contributingguide.html"><span class="header-section-number">16</span> Contributing Guide</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="booknews.html"><span class="header-section-number">A</span> NEWS</a></li>
<li><a class="" href="reviewtemplate.html"><span class="header-section-number">B</span> Review template</a></li>
<li><a class="" href="reviewtemplatees.html"><span class="header-section-number">C</span> Review template in Spanish</a></li>
<li><a class="" href="editortemplate.html"><span class="header-section-number">D</span> Editor’s template</a></li>
<li><a class="" href="reviewrequesttemplate.html"><span class="header-section-number">E</span> Review request template</a></li>
<li><a class="" href="approvaltemplate.html"><span class="header-section-number">F</span> Approval comment template</a></li>
<li><a class="" href="approval2template.html"><span class="header-section-number">G</span> Reviewer approval comment template</a></li>
<li><a class="" href="newstemplate.html"><span class="header-section-number">H</span> NEWS template</a></li>
<li><a class="" href="bookreleaseissue.html"><span class="header-section-number">I</span> Book release guidance</a></li>
<li><a class="" href="redirect.html"><span class="header-section-number">J</span> How to set a redirect</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ropensci/dev_guide">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="package-development-security-best-practices" class="section level1">
<h1>
<span class="header-section-number">3</span> Package Development Security Best Practices<a class="anchor" aria-label="anchor" href="#package-development-security-best-practices"><i class="fas fa-link"></i></a>
</h1>
<div class="summaryblock">
<p>
This work-in-progress chapter includes <a href="package-development-security-best-practices.html#pkgsecrets">guidance about managing secrets in packages</a> and <a href="package-development-security-best-practices.html#furthersecreading">links for further reading</a>.
</p>
</div>
<div id="miscellaneous" class="section level2">
<h2>
<span class="header-section-number">3.1</span> Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>We recommend you <a href="https://help.github.com/articles/securing-your-account-with-two-factor-authentication-2fa/">secure your GitHub account with 2FA</a>.</p></li>
<li><p>If the web service your package wraps has either https or http, opt for https.</p></li>
</ul>
</div>
<div id="pkgsecrets" class="section level2">
<h2>
<span class="header-section-number">3.2</span> Secrets in packages<a class="anchor" aria-label="anchor" href="#pkgsecrets"><i class="fas fa-link"></i></a>
</h2>
<p>This section contains guidance for when you develop a package interacting with a web resource requiring credentials (API keys, tokens, etc.). Also refer to <a href="https://httr.r-lib.org/articles/secrets.html">the <code>httr</code> vignette about sharing secrets</a>.</p>
<div id="secrets-in-packages-and-user-protection" class="section level3">
<h3>
<span class="header-section-number">3.2.1</span> Secrets in packages and user protection<a class="anchor" aria-label="anchor" href="#secrets-in-packages-and-user-protection"><i class="fas fa-link"></i></a>
</h3>
<p>Say your package needs an API key for making requests on behalf of users of your package.</p>
<ul>
<li>
<p>In your package documentation, guide the user so the API key doesn’t end up in the .Rhistory/script of users of your package.</p>
<ul>
<li><p>Encourage the use of environment variables to store the API key (or even remove the possibility to pass it as an argument to the functions?). You could link <a href="https://rstats.wtf/r-startup.html">to this intro to startup files</a> and <a href="https://usethis.r-lib.org/reference/edit.html"><code>usethis::edit_r_environ()</code></a>.</p></li>
<li><p>Or your package could depend on, or encourage the use of, <a href="https://github.com/r-lib/keyring#readme"><code>keyring</code> to help user store variables</a> in the specific OS’ credential stores (more secure than .Renviron): i.e. you’d create a function for setting the key, and have another one for retrieving the key; or the user would write <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv(SUPERSECRETKEY = keyring::key_get("myservice"))</a></code> at the beginning of their script.</p></li>
<li><p>Do not print the API key even in verbose mode in any message, warning, error.</p></li>
</ul>
</li>
<li><p>In the GitHub issue template, it should be stated not to share any credentials (it’s the case for <a href="https://docs.ropensci.org/rodev/reference/use_ro_github.html">rOpenSci issue template</a>). If an user of your package accidentally shares credentials in an issue, make sure they’re aware of that so they can revoke the key (i.e. ask them explicitly in an answer whether they realized they shared their key).</p></li>
</ul>
</div>
<div id="secrets-in-packages-and-development" class="section level3">
<h3>
<span class="header-section-number">3.2.2</span> Secrets in packages and development<a class="anchor" aria-label="anchor" href="#secrets-in-packages-and-development"><i class="fas fa-link"></i></a>
</h3>
<p>You’ll need to protect your secrets as you protect secrets of users, but there’s more to take into account and keep in mind.</p>
<div id="secrets-and-recorded-requests-in-tests" class="section level4">
<h4>
<span class="header-section-number">3.2.2.1</span> Secrets and recorded requests in tests<a class="anchor" aria-label="anchor" href="#secrets-and-recorded-requests-in-tests"><i class="fas fa-link"></i></a>
</h4>
<p>If you use <a href="https://docs.ropensci.org/vcr/"><code>vcr</code></a> or <a href="https://enpiar.com/r/httptest/"><code>httptest</code></a> in tests for caching API responses, you need to make sure the recorded requests / fixtures do not contain secrets. Refer to <a href="https://books.ropensci.org/http-testing/security-chapter.html"><code>vcr</code> security guidance</a> and <a href="https://enpiar.com/r/httptest/articles/redacting.html"><code>httptest</code> guidance “Redacting and Modifying Recorded Requests”</a>, and inspect your recorded requests / fixtures before committing them the first time to be sure you got the setup right.</p>
<p><code>vcr</code> being an rOpenSci package, you can post any question you might have to <a href="https://discuss.ropensci.org/">rOpenSci forum</a></p>
</div>
<div id="share-secrets-with-ci-services" class="section level4">
<h4>
<span class="header-section-number">3.2.2.2</span> Share secrets with CI services<a class="anchor" aria-label="anchor" href="#share-secrets-with-ci-services"><i class="fas fa-link"></i></a>
</h4>
<p>Now, you might need to share secrets with <a href="ci.html#ci">continuous integration services</a>.</p>
<p>You could store API keys as environment variables / secrets, referring to the docs of the CI service.</p>
<p>For more details and workflow advice, refer <a href="https://gargle.r-lib.org/articles/articles/managing-tokens-securely.html">to the gargle article “Managing tokens securely”</a> and the <a href="https://books.ropensci.org/http-testing/security-chapter.html">security chapter of the HTTP testing in R book</a>.</p>
<p>Document the steps you made in <a href="collaboration.html#friendlyfiles">CONTRIBUTING.md</a> so you, or say a new maintainer, can remember how to do that next time.</p>
</div>
<div id="secrets-and-collaborations" class="section level4">
<h4>
<span class="header-section-number">3.2.2.3</span> Secrets and collaborations<a class="anchor" aria-label="anchor" href="#secrets-and-collaborations"><i class="fas fa-link"></i></a>
</h4>
<p>What about pull requests from external contributors? Tests using your secrets will fail unless you use some sort of mocked/cached response, so you might want to skip them depending on the context. For instance, in your CI account you could create an environment variable called <code>THIS_IS_ME</code> and then skip tests based on the presence of this variable. This obviously means the PR checks by the CI are not exhaustive, so you’ll need to check out the PR locally to run all tests.</p>
<p>Document the behavior of your package for external PRs in <a href="collaboration.html#friendlyfiles">CONTRIBUTING.md</a> for the sake of people making PRs and of people reviewing them (you in a few weeks, and other authors of the package).</p>
</div>
</div>
<div id="secrets-and-cran" class="section level3">
<h3>
<span class="header-section-number">3.2.3</span> Secrets and CRAN<a class="anchor" aria-label="anchor" href="#secrets-and-cran"><i class="fas fa-link"></i></a>
</h3>
<p>On CRAN, skip any tests (<code>skip_on_cran()</code>) and examples (<code>dontrun</code>) requiring credentials.</p>
<p><a href="https://ropensci.org/technotes/2019/12/08/precompute-vignettes/">Precompute vignettes</a> requiring credentials.</p>
</div>
</div>
<div id="furthersecreading" class="section level2">
<h2>
<span class="header-section-number">3.3</span> Further reading<a class="anchor" aria-label="anchor" href="#furthersecreading"><i class="fas fa-link"></i></a>
</h2>
<p>Useful security resources:</p>
<ul>
<li><p><a href="https://ropensci.org/commcalls/2019-05-07/">rOpenSci community call “Security for R”</a> (recording, slides, etc. see in particular <a href="https://ropensci.org/blog/2019/04/09/commcall-may2019/#resources">the list of resources</a>);</p></li>
<li><p><a href="https://ropensci.org/blog/2018/06/06/unconf18_recap_2/">the security-related projects of unconf18</a>;</p></li>
<li><p><a href="https://ropensci.org/blog/2017/07/25/notary/">the <code>notary</code> package</a>;</p></li>
<li><p><a href="gargle.r-lib.org/articles/articles/managing-tokens-securely.html"><code>gargle</code> article “Managing tokens securely”</a></p></li>
<li><p>elements outlined in <a href="https://ropenscilabs.github.io/r-security-practices/">this bookdown</a> (<a href="https://github.com/ropenscilabs/r-security-practices">repo</a>) started at the unconf 2017.</p></li>
</ul>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="ci.html"><span class="header-section-number">2</span> Continuous Integration Best Practices</a></div>
<div class="next"><a href="softwarereviewintro.html"><span class="header-section-number">4</span> Software Peer Review, Why? What?</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#package-development-security-best-practices"><span class="header-section-number">3</span> Package Development Security Best Practices</a></li>
<li><a class="nav-link" href="#miscellaneous"><span class="header-section-number">3.1</span> Miscellaneous</a></li>
<li>
<a class="nav-link" href="#pkgsecrets"><span class="header-section-number">3.2</span> Secrets in packages</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#secrets-in-packages-and-user-protection"><span class="header-section-number">3.2.1</span> Secrets in packages and user protection</a></li>
<li><a class="nav-link" href="#secrets-in-packages-and-development"><span class="header-section-number">3.2.2</span> Secrets in packages and development</a></li>
<li><a class="nav-link" href="#secrets-and-cran"><span class="header-section-number">3.2.3</span> Secrets and CRAN</a></li>
</ul>
</li>
<li><a class="nav-link" href="#furthersecreading"><span class="header-section-number">3.3</span> Further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ropensci/dev_guide/blob/master/pkg_security.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ropensci/dev_guide/edit/master/pkg_security.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>rOpenSci Packages: Development, Maintenance, and Peer Review</strong>" was written by rOpenSci software review editorial team (current and alumni): Brooke Anderson, Scott Chamberlain, Laura DeCicco, Julia Gustavsen, Anna Krystalli, Mauro Lepore, Lincoln Mullen, Karthik Ram, Noam Ross, Maëlle Salmon, Melina Vidoni. It was last built on 2021-03-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
